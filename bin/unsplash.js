#! /usr/local/bin/node
import"readline";import"path";import e from"fs";import o from"sharp";import{init as a}from"liburno_lib";import{exec as r}from"child_process";import i from"minimist";const{Reset:n,Bold:t,Reverse:l,Red:s,Green:c,Yellow:u,Blue:p,Magenta:m,Cyan:$,White:g}=a(),d=`${t}unsplash${n} :             Query images from unsplash (c) Croswil 2023 v1.1\n${t}Uso: ${c}unsplash <query> <flags> ${n}   \n\n${t}flags:${n}\n   ${c}-h, --help${n}              mostra l'help\n   ${c}-o, --output${n} <folder>   cartella di outputmodo sul file .env [public,test,altro]   \n   ${c}-n, --numero${n} <n>        numero immagini da scaricare: (default = 1)  \n   ${c}-p, --pagina${n} <p>        serve per cercare una immagine successiva alle pi√π visualizzate (default = 0)  \n   ${c}-l, --latest${n}            ordina la selezione dalle ultime caricate\n   ${c}-c, --colore${n} <c>        colori: black_and_white, black, white, yellow, orange, red, purple, magenta, green, teal, and blue  \n   ${c}-x, --orizzontale${n}       Orizzontale  \n   ${c}-y, --verticale${n}         Verticale  \n   ${c}-q, --quadrato${n}          Immagine Quadrata\n   ${c}-s, --size${n} <s>          Dimensione X immagine   \n`,f=i(process.argv);function v(e){return new Promise(((o,a)=>{r(e,((e,r,i)=>{e?a(e):o(r)}))}))}(0==f._.length||f.h||f.help)&&(console.log(d),process.exit(0)),async function(){var a=f.o||f.output||"out",r=a.split("/").pop();if(e.existsSync(a))console.log("cambia il percorso di output o cancella i dati!");else{console.log("QUERY:",f._[2]);var i=encodeURIComponent(f._[2]);if(i){var l=[];var c=`https://api.unsplash.com/search/photos?query=${i}&page=${f.p||f.pagina||1}&per_page=${f.n||f.numero||1}&order_by=${f.latest||f.l?"latest":"relevant"}`;(f.color||f.c)&&(c=`${c}&color=${f.c||f.color}`),f.orizzontale||f.x?c=`${c}&orientation=landscape`:f.verticale||f.y?c=`${c}&orientation=portrait`:(f.quadrato||f.q)&&(c=`${c}&orientation=squarish`),console.log(c);var u=await v(`\n                curl -H "Authorization: Client-ID I-u34HEOfOSp5jXxrnMnTQv26NRtxGNB_4MVvHkkmrs" "${c}"\n            `),p=JSON.parse(u);for(var m of p.results)l.push({id:m.id,datacrea:m.created_at,img:m.urls.full,categories:m.categories,likes:m.likes,username:m.username,nome:m.user.first_name,cognome:m.user.last_name,bio:m.user.bio,location:m.user.location});await v(`rm -rdf ${a}; mkdir ${a};mkdir ${a}/json ;mkdir ${a}/img; `);var $=0;for(var m of l){var g=r+"_"+("00000"+ ++$).slice(-4);console.log(g,m.img),e.writeFileSync(`${a}/json/${g}.json`,JSON.stringify(m,null,2)),parseInt(f.s||f.size)?(await v(`curl -H "Authorization: Client-ID I-u34HEOfOSp5jXxrnMnTQv26NRtxGNB_4MVvHkkmrs" "${m.img}" >out.jpeg`),await o("out.jpeg").resize(parseInt(f.s||f.size)).toFile(`${a}/img/${g}.jpeg`),e.unlinkSync("out.jpeg")):await v(`curl -H "Authorization: Client-ID I-u34HEOfOSp5jXxrnMnTQv26NRtxGNB_4MVvHkkmrs" "${m.img}" >${a}/img/${g}.jpeg`)}}else console.log(d),console.log(`\n${s}${t}Manca la query...${n}`)}}();
